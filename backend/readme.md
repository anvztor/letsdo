# Dependencies installed

- npm install --save express
- npm install --save lodash
- npm install --save cookie-parser
- npm install --save winston
- npm install --save yup
- npm install --save dotenv
- npm install --save bcrypt
- npm install --save jsonwebtoken
- npm install --save cors
- npm install --save hardhat
- npm install --save @nomicfoundation/hardhat-toolbox

# Start app

You could run the app in two modes: **local mode** and **testnet(sepolia) mode**. Choose the one you prefer to.
Enjoy~

## (Local mode)Start app using local blockchain

- Install dependences by running `npm install` under the root directory
- Start harthat by running `npx hardhat node` under the root directory
- Deploy contracts/MyTodo.sol on local hardhat (I used the remix to deploy it to hardhat)
- Update the value of config.contractAddr in config/config.test.js to the address of contracts/MyTodo.sol after deloyment
- Update the value of config.privateKey in config/config.test.js to the private key of the account which exists in the local hardhat enviroment
- Start node project:

```
npm run start_win_test  (windows)
```

## (Testnet mode)Start app using testnet sepolia

- Install dependence by running `npm install` under the root directory
- Make sure you have an account in Infura and created an API endpoint already
  ![image info](./pics/create-new-api-key.png)
- Deploy contracts/MyTodo.sol to sepolia (I used remix + metamask to deploy it to sepolia)
- Update the value of config.contractAddr in config/config.dev.js to the address of contracts/MyTodo.sol deployed on sepolia
- Update the value of config.privateKey in config/config.dev.js to the private key of your wallet(MetaMask) private key
- Update the value of config.INFURA_API_KEY in config/config.dev.js to the new API key
  ![image info](./pics/new-api-key.png)
- Start node project:

```
npm run start_win_dev  (windows)
```

# How to interact with app using restful Apis

1. Register a new user
   http://127.0.0.1:3100/apis/v1/users/register (Post)
   An example of json body:

```
{
 d    "name" : "justor95",
    "password" : "qwer1234",
    "passwordConfirm": "qwer1234",
    "roles": ["user"],
    "age" : 20,
    "email": "justor95@hotmail.com"
}
```

You will get response like this:

```
{
    "success": true,
    "code": 200,
    "message": "User justor95 is registered successfully"
}
```

2. Login with the new user

http://127.0.0.1:3100/apis/v1/users/login (Post)
An example of json body:

```
{
    "name" : "justor95",
    "password" : "qwer1234"
}
```

You will get response like this:

```
{
    "success": true,
    "code": 200,
    "message": "User justor95 logined successfully(en)",
    "data": {
        "id": 0,
        "name": "justor95",
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MCwibmFtZSI6ImphbmVzcyIsInJvbGVzIjpbInVzZXIiXSwiZW1haWwiOiJqYW5lc3NhQGdtYWlsLmNvbSIsImlhdCI6MTcwMjUxODgzMiwiZXhwIjoxNzAyNTM2ODMyfQ.Nlx2e-9f0WYQrKBl_jbVheqnvqHGVKOGsPA5uO9zkSo"
    }
}
```

**Notice that we will use the token retured above to proceed with the rest of APIs**

3. Create new todos
   http://127.0.0.1:3100/apis/v1/todos/ (Post)
   _(Pls fill the token generated by login in Authorization Tab in postman, choose `Bear Token`)_
   ![image info](./pics/fill-token.png)

- The first todo added:
  The request json body:

```
{
    "user" : 0,
    "title" : "This is the title for the first todo",
    "body": "todo1 content"
}
```

The reponse like this:

```
{
    "success": true,
    "code": 200,
    "message": "Todo 0 is created for user 0 successfully",
    "data": {
        "id": 0,
        "title": "This is the title for the first todo",
        "body": "todo1 content"
    }
}
```

- The second todo added:
  The request json body:

```
{
    "user" : 0,
    "title" : "This is the title for the second todo",
    "body": "todo2 content"
}
```

The reponse like this:

```
{
    "success": true,
    "code": 200,
    "message": "Todo 1 is created for user 0 successfully",
    "data": {
        "id": 1,
        "title": "This is the title for the second todo",
        "body": "todo2 content"
    }
}
```

- Get the list of todos for a specific user
  http://127.0.0.1:3100/apis/v1/todos/<user id> (Get)

  In this case, user id is 0, the complete url is : http://127.0.0.1:3100/apis/v1/todos/0
  _(Pls fill the token generated by login in Authorization Tab in postman, choose `Bear Token`)_

  You will get response like below:

```
{
    "success": true,
    "code": 200,
    "message": "Get all todos for user 0 successfully",
    "data": {
        "0": {
            "id": 0,
            "title": "This is the title for the first todo",
            "body": "todo1 content"
        },
        "1": {
            "id": 1,
            "title": "This is the title for the second todo",
            "body": "todo2 content"
        }
    }
}
```

4. Update an exsiting todo
   http://127.0.0.1:3100/apis/v1/todos/ (Put)
   _(Pls fill the token generated by login in Authorization Tab in postman, choose `Bear Token`)_

Let's update modify the todo with id being 0 for the user with id being 0.

The request json body:

```
{
    "user" : 0,
    "id": 0,
    "title" : "This is the new title for the first todo",
    "body": "todo1 new content"
}
```

You will get response like this:

```
{
    "success": true,
    "code": 200,
    "message": "Todo 0 is updated for user 0 successfully",
    "data": {
        "id": 0,
        "title": "This is the new title for the first todo",
        "body": "todo1 new content"
    }
}
```

Let's have a double check by sending request: http://127.0.0.1:3100/apis/v1/todos/0

You will get a response like this:

```
{
    "success": true,
    "code": 200,
    "message": "Get all todos for user 0 successfully",
    "data": {
        "0": {
            "id": 0,
            "title": "This is the new title for the first todo",
            "body": "todo1 new content"
        },
        "1": {
            "id": 1,
            "title": "This is the title for the second todo",
            "body": "todo2 content"
        }
    }
}
```

You see, the todo with id being 0 is updated with the new title and the new body. Great!

5. Delete a todo
   http://127.0.0.1:3100/apis/v1/todos/<user id>/<todo id> (delete)
   _(Pls fill the token generated by login in Authorization Tab in postman, choose `Bear Token`)_

Let's delete the todo with id being 0 for the user with id being 0
The complete url is: http://127.0.0.1:3100/apis/v1/todos/0/0

You will get the reponse like this:

```
{
    "success": true,
    "code": 200,
    "message": "Todo 0 is deleted for user 0 successfully"
}
```

Let's have a double check by sending request: http://127.0.0.1:3100/apis/v1/todos/0

You will get a response like this:

```
{
    "success": true,
    "code": 200,
    "message": "Get all todos for user 0 successfully",
    "data": {
        "1": {
            "id": 1,
            "title": "This is the title for the second todo",
            "body": "todo2 content"
        }
    }
}
```

You see that the todo with id being 0 is gone, only one todo is available for the user with id being 0
